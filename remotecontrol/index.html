
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../importdeepracercarla/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Remote control Deepracer - URJC-DeepRacer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#remote-control-deepracer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="URJC-DeepRacer" class="md-header__button md-logo" aria-label="URJC-DeepRacer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            URJC-DeepRacer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Remote control Deepracer
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="URJC-DeepRacer" class="md-nav__button md-logo" aria-label="URJC-DeepRacer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    URJC-DeepRacer
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../racetrackcreation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Racetrack Creation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../includeracetrackcarla/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Include Racetrack in a CARLA Map
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../createdeepracerinblender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create DeepRacer in Blender
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../importdeepracercarla/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Import Deepracer to Carla
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Remote control Deepracer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Remote control Deepracer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-run-it" class="md-nav__link">
    <span class="md-ellipsis">
      How to run it??
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joystick-client" class="md-nav__link">
    <span class="md-ellipsis">
      Joystick client
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiver" class="md-nav__link">
    <span class="md-ellipsis">
      Receiver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-events-does-the-joystick-send-when-you-move-it" class="md-nav__link">
    <span class="md-ellipsis">
      What events does the joystick send when you move it?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-run-it" class="md-nav__link">
    <span class="md-ellipsis">
      How to run it??
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joystick-client" class="md-nav__link">
    <span class="md-ellipsis">
      Joystick client
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#receiver" class="md-nav__link">
    <span class="md-ellipsis">
      Receiver
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Receiver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-events-does-the-joystick-send-when-you-move-it" class="md-nav__link">
    <span class="md-ellipsis">
      What events does the joystick send when you move it?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="remote-control-deepracer">Remote Control Deepracer</h1>
<video width="1280" height="720" controls>
  <source src="../images/Remote.mp4" type="video/mp4">
</video>

<p>This guide explains how to use a PS4 Controller (Dualshock) connected to your local laptop to remotely control a vehicle in CARLA simulator running on a remote server. The connection between the joystick and CARLA is made through SSH and socket communication.</p>
<p><img alt="1" src="../images/ps4.jpeg" /></p>
<p>It was made like this, so that we could use a much better PC and connect it through SSH to our laptop. However, it can be all done in the same PC at once by directly sending data to the Carla server.</p>
<p>Besides, any controller can be used, as long as you are able to get its data. This implementation was also tested in an Xbox Controller and Nintendo Switch Pro Controller and it worked as well. (Notice how each device sends messages in different ways with different intervals).</p>
<p>Make sure that you have installed evdev Python package:</p>
<pre><code class="language-bash">pip install evdev
</code></pre>
<p>Make sure it works by typing:</p>
<pre><code class="language-bash">sudo evtest
</code></pre>
<pre><code class="language-bash">No device specified, trying to scan all of /dev/input/event*
Available devices:
/dev/input/event0:  Lid Switch
/dev/input/event1:  Sleep Button
/dev/input/event2:  Power Button
/dev/input/event3:  Power Button
/dev/input/event4:  AT Translated Set 2 keyboard
/dev/input/event5:  CUST0001:00 04F3:30AA Mouse
/dev/input/event6:  CUST0001:00 04F3:30AA Touchpad
/dev/input/event7:  ETPS/2 Elantech Touchpad
/dev/input/event8:  Corsair CORSAIR HARPOON RGB PRO Gaming Mouse
/dev/input/event9:  Corsair CORSAIR HARPOON RGB PRO Gaming Mouse
/dev/input/event10: Corsair CORSAIR HARPOON RGB PRO Gaming Mouse
/dev/input/event11: MSI WMI hotkeys
/dev/input/event12: gpio-keys
/dev/input/event13: Video Bus
/dev/input/event14: Video Bus
/dev/input/event15: HDA Intel PCH Mic
/dev/input/event16: HDA Intel PCH Headphone
/dev/input/event17: HDA Intel PCH HDMI/DP,pcm=3
/dev/input/event18: HDA Intel PCH HDMI/DP,pcm=7
/dev/input/event19: HDA Intel PCH HDMI/DP,pcm=8
/dev/input/event20: Sony Interactive Entertainment Wireless Controller
/dev/input/event21: Sony Interactive Entertainment Wireless Controller Motion Sensors
/dev/input/event22: Sony Interactive Entertainment Wireless Controller Touchpad
Select the device event number [0-22]: 
</code></pre>
<p>In my case, I'm currently using a PS4 controller, and I only want to use its buttons — not the touchpad or sensors. As so, I'll be typing 20 and be able to watch the values changing from ranges 0-255 while moving the joysticks:</p>
<pre><code class="language-bash">Event: time 1754051218.570172, -------------- SYN_REPORT ------------
Event: time 1754051218.574173, type 3 (EV_ABS), code 0 (ABS_X), value 65
Event: time 1754051218.574173, type 3 (EV_ABS), code 1 (ABS_Y), value 221
Event: time 1754051218.574173, type 3 (EV_ABS), code 3 (ABS_RX), value 87
Event: time 1754051218.574173, type 3 (EV_ABS), code 4 (ABS_RY), value 254
Event: time 1754051218.574173, -------------- SYN_REPORT ------------
Event: time 1754051218.578170, type 3 (EV_ABS), code 0 (ABS_X), value 55
Event: time 1754051218.578170, type 3 (EV_ABS), code 1 (ABS_Y), value 228
Event: time 1754051218.578170, type 3 (EV_ABS), code 3 (ABS_RX), value 81
Event: time 1754051218.578170, type 3 (EV_ABS), code 4 (ABS_RY), value 252
Event: time 1754051218.578170, -------------- SYN_REPORT ------------
Event: time 1754051218.582177, type 3 (EV_ABS), code 0 (ABS_X), value 46
Event: time 1754051218.582177, type 3 (EV_ABS), code 1 (ABS_Y), value 234
Event: time 1754051218.582177, type 3 (EV_ABS), code 3 (ABS_RX), value 75
Event: time 1754051218.582177, type 3 (EV_ABS), code 4 (ABS_RY), value 249
Event: time 1754051218.582177, -------------- SYN_REPORT ------------
Event: time 1754051218.586179, type 3 (EV_ABS), code 0 (ABS_X), value 39
Event: time 1754051218.586179, type 3 (EV_ABS), code 1 (ABS_Y), value 240
Event: time 1754051218.586179, type 3 (EV_ABS), code 3 (ABS_RX), value 69
Event: time 1754051218.586179, type 3 (EV_ABS), code 4 (ABS_RY), value 246
Event: time 1754051218.586179, -------------- SYN_REPORT ------------
Event: time 1754051218.590181, type 3 (EV_ABS), code 0 (ABS_X), value 34
Event: time 1754051218.590181, type 3 (EV_ABS), code 1 (ABS_Y), value 239
Event: time 1754051218.590181, type 3 (EV_ABS), code 3 (ABS_RX), value 62
Event: time 1754051218.590181, type 3 (EV_ABS), code 4 (ABS_RY), value 245
Event: time 1754051218.590181, -------------- SYN_REPORT ------------
</code></pre>
<p>If this worked for you, your device is connected.</p>
<p>To test its workability, as we are using sockets, we will have the joystick client code on our laptop and the carla receiver in the remote server.</p>
<h3 id="how-to-run-it">How to run it??</h3>
<p><strong>Step 1</strong>: Run Receiver on Remote Server:</p>
<pre><code class="language-bash">python3 receiver_car_control.py
</code></pre>
<p><strong>Step 2</strong>: SSH Port Forwarding (on local laptop)</p>
<p>Open one terminal and connect ssh to the remote server. Make sure that you are using an available port, avoid the commonly used ones. In my case I'll be using PORT 1977</p>
<pre><code class="language-bash">ssh -p PORT user@host
</code></pre>
<p>If you are using an intermediate remote pc to reach the final destination:</p>
<pre><code class="language-bash">ssh -J user@midhost user@finalhost -L PORT:localhost:PORT
</code></pre>
<p>Keep this terminal open.</p>
<p><strong>Step 3</strong>: Run Joystick Client on Local Laptop</p>
<pre><code class="language-bash">python3 joystick_client.py
</code></pre>
<h2 id="joystick-client">Joystick client</h2>
<pre><code class="language-python3">import socket
from evdev import InputDevice, categorize, ecodes, list_devices
import select

HOST = 'localhost'
PORT = 1977

# Search for device
devices = [InputDevice(path) for path in list_devices()]
joystick = None
for device in devices:
    if &quot;Sony&quot; in device.name or &quot;Wireless Controller&quot; in device.name or &quot;PS4&quot; in device.name:
        joystick = device
        break

if not joystick:
    print(&quot;No PS4 controller found&quot;)
    exit()

print(f&quot;? Using device: {joystick.path} - {joystick.name}&quot;)

# Connect
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect((HOST, PORT))
    print(&quot;? Connected to receiver&quot;)

    abs_x = 0
    abs_z = 0     # L2
    abs_rz = 0    # R2

    for event in joystick.read_loop():
        if event.type == ecodes.EV_ABS:
            if event.code == ecodes.ABS_X:      # Left joystick (steer)
                abs_x = event.value
            elif event.code == ecodes.ABS_Z:    # L2
                abs_z = event.value
            elif event.code == ecodes.ABS_RZ:   # R2
                abs_rz = event.value

            # Send values
            msg = f&quot;[ABS_X] {abs_x}[R2] {abs_rz}[L2] {abs_z}\n&quot;
            s.sendall(msg.encode())
</code></pre>
<h2 id="receiver">Receiver</h2>
<p>This code simply allows you to check whether messages have been received or not:</p>
<pre><code class="language-python3">import socket

HOST = 'localhost'
PORT = 1977

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind((HOST, PORT))
    s.listen()
    print(f&quot;Waiting for connection on {HOST}:{PORT}...&quot;)
    conn, addr = s.accept()
    with conn:
        print(f&quot;Connected from {addr}&quot;)
        while True:
            data = conn.recv(1024)
            if not data:
                break
            msg = data.decode().strip()
            print(f&quot;{msg}&quot;)
</code></pre>
<h3 id="what-events-does-the-joystick-send-when-you-move-it">What events does the joystick send when you move it?</h3>
<p>When you move a game controller joystick (e.g., Nintendo Switch Pro Controller or PS4 DualShock) on Linux, the system sends axis events via the input system (like /dev/input/eventXX). These are the main axis events you receive:</p>
<p><strong>ABS_X:    Left joystick – Left/Right  From 0 to 255</strong></p>
<p><strong>R2:   Right Trigger – From From 0 to 255</strong></p>
<p><strong>L2:   Left Trigger – From From 0 to 255</strong></p>
<p>These values change dynamically as you move the sticks.</p>
<p>Example of raw messages from the joystick
If you print the raw values as they come in, you may see:</p>
<pre><code class="language-bash">[ABS_X] 140[R2] 97[L2] 21
[ABS_X] 140[R2] 100[L2] 21
[ABS_X] 146[R2] 100[L2] 21
[ABS_X] 146[R2] 100[L2] 20
[ABS_X] 146[R2] 101[L2] 20
[ABS_X] 150[R2] 101[L2] 20
[ABS_X] 150[R2] 102[L2] 20
[ABS_X] 154[R2] 102[L2] 20
</code></pre>
<p>These messages show axis events where the numbers indicate how far and in what direction the joystick or thrigger has been moved.</p>
<p>Now we will use a manual control code to test this in a Carla world.</p>
<p>Execute the Unreal Engine package from the carla root folder:</p>
<pre><code>CarlaUE4.sh
</code></pre>
<p>located at :</p>
<pre><code>/Dist/CARLA_Shipping_0.9.15.2-2-gb23c01ae4-dirty/LinuxNoEditor
</code></pre>
<p>Now the server will be available to be connected to. Note that it can be launched with the flag ---RenderOffscreen to make it handier to use later.</p>
<p>Then for the client, you can use the same client code as before.
For the remote receiver, you have to create a python file (.py) so that the Deepracer behaves as the joystick is sending data.</p>
<pre><code class="language-python3">import carla
import time
import pygame
import numpy as np
import socket

# Socket config
HOST = 'localhost'
PORT = 1977

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(1)
print(f&quot;Waiting for connection {HOST}:{PORT}...&quot;)
conn, addr = s.accept()
print(f&quot;Connected from {addr}&quot;)

# Carla config
WIDTH, HEIGHT = 800, 600
pygame.init()
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption(&quot;DeepRacer - Remote control&quot;)

client = carla.Client('127.0.0.1', 2000)
client.set_timeout(5.0)
world = client.get_world()

weather = carla.WeatherParameters(
    cloudiness=80.0,
    precipitation=0.0,
    sun_altitude_angle=90.0,
    fog_density=0.0,
    wetness=0.0
)
world.set_weather(weather)

blueprint_library = world.get_blueprint_library()
vehicle_bp = blueprint_library.find('vehicle.finaldeepracer.aws_deepracer')

spawn_point = carla.Transform(
    carla.Location(x=-7, y=-15, z=0.5),
    carla.Rotation(yaw=-15)
)

vehicle = world.try_spawn_actor(vehicle_bp, spawn_point)
if not vehicle:
    print(&quot;Unable to spawn vehicle&quot;)
    exit()
print(&quot;Vehicle spawned correctly&quot;)

camera_bp = blueprint_library.find('sensor.camera.rgb')
camera_bp.set_attribute('image_size_x', str(WIDTH))
camera_bp.set_attribute('image_size_y', str(HEIGHT))
camera_bp.set_attribute('fov', '90')
camera_transform = carla.Transform(carla.Location(x=-1, z=0.5))
camera = world.spawn_actor(camera_bp, camera_transform, attach_to=vehicle)

camera_image = None
def process_image(image):
    global camera_image
    array = np.frombuffer(image.raw_data, dtype=np.uint8)
    array = np.reshape(array, (image.height, image.width, 4))[:, :, :3]
    array = array[:, :, ::-1]
    camera_image = pygame.surfarray.make_surface(array.swapaxes(0, 1))
camera.listen(process_image)

# Control vars
control = carla.VehicleControl()
current_steer = 0.0
current_throttle = 0.0
current_brake = 0.0

running = True
while running:
    try:
        buffer = conn.recv(1024).decode(errors='ignore').strip()
        if not buffer:
            continue

        lines = buffer.splitlines()
        for line in lines:
            if &quot;[ABS_X]&quot; in line and &quot;[R2]&quot; in line and &quot;[L2]&quot; in line:
                try:
                    parts = line.strip().split(&quot;[ABS_X]&quot;)
                    if len(parts) &gt; 1:
                        vals = parts[1].split(&quot;[R2]&quot;)
                        if len(vals) == 2:
                            steer_val = int(vals[0].strip())
                            rest = vals[1].split(&quot;[L2]&quot;)
                            if len(rest) == 2:
                                r2_val = int(rest[0].strip())
                                l2_val = int(rest[1].strip())

                                # Escalar steer de 0-255 a -1 a 1
                                current_steer = (steer_val - 127) / 128.0
                                current_steer = max(-1.0, min(1.0, current_steer))

                                # Escalar R2 (aceleración) de 0-255 a 0.0-1.0
                                current_throttle = max(0.0, min(1, r2_val / 255.0))

                                # Escalar L2 (freno) de 255-0 a 0.001-0.1
                                brake_normalized = 1.0 - (l2_val / 255.0)
                                current_brake =  max(0.0, min(1.0, l2_val / 255.0))
                except Exception as e:
                    print(&quot;⚠️ Error parsing line:&quot;, e)
                    continue

        # Apply control
        control.steer = current_steer
        control.throttle = current_throttle
        control.brake = current_brake
        vehicle.apply_control(control)

        # Show camera
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
        if camera_image:
            screen.blit(camera_image, (0, 0))
        pygame.display.flip()

        # Speed display
        velocity = vehicle.get_velocity()
        speed = (velocity.x**2 + velocity.y**2 + velocity.z**2)**0.5
        print(f&quot;Speed: {speed:.2f} m/s | Steer: {control.steer:.2f} | Throttle: {control.throttle:.2f} | Brake: {control.brake:.3f}&quot;)

    except KeyboardInterrupt:
        print(&quot;Interrupted&quot;)
        break

# Cleanup
camera.destroy()
vehicle.destroy()
pygame.quit()
conn.close()
s.close()
print(&quot;Session ended.&quot;)

</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>